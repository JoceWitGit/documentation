<!DOCTYPE html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="A HIPAA-compliant research system on AWS">
<meta name="keywords" content="AWSHIPAAmedicinedata_managementcase_studiesstorageresearch_computingdata_science,  aws, hipaa">
<title>AWS HIPAA | Research Computing Resources</title>
<link rel="stylesheet" href="css/syntax.css">


<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/lavish-bootstrap.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/theme-purple.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://idratherbewriting.comfeed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> Research Computing Resources</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- entries without drop-downs appear here -->
                
                
                
                <li><a href="calendar.html">Calendar</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Jekyll Resources<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://github.com/tomjohnson1492/documentation-theme-jekyll" target="_blank">Github Repo</a></li>
                        
                        
                        
                        <li><a href="https://talk.jekyllrb.com" target="_blank">Jekyll Talk</a></li>
                        
                        
                        
                        <li><a href="http://jekyllrb.com/docs/home/" target="_blank">Jekyll documentation</a></li>
                        
                        
                        
                        <li><a href="http://stackoverflow.com/questions/tagged/jekyll" target="_blank">Jekyll on Stack Overflow</a></li>
                        
                        
                        
                        <li><a href="http://idratherbewriting.com/category-jekyll/" target="_blank">Jekyll on my blog</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
			<li><a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:amandach@uw.edu?subject=Cloud maven f eedback&body=I have some feedback about the AWS HIPAA page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a><li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="AWS HIPAA">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
    <div class="col-lg-12">&nbsp;</div>
    <!-- Content Row -->
    <div class="row">
        <!-- Sidebar Column -->
        <div class="col-md-3">

          












<ul id="mysidebar" class="nav">
    <li class="sidebarTitle">Documentation </li>
    
    
    
        
    
    <li>
        <a href="#">Cloud Core</a>
        <ul>
            
            
            
            <li><a href="cc_what_is_the_cloud.html">What is the cloud?</a></li>
            
            
            
            
            
            
            <li><a href="cc_data_security.html">Data security</a></li>
            
            
            
            
            
            
            <li><a href="cc_glossary.html">Glossary</a></li>
            
            
            
            
            
            
            <li><a href="cc_cost_management.html">Cost management</a></li>
            
            
            
            
            
            
            <li><a href="cc_compute_power.html">Compute power</a></li>
            
            
            
            
            
            
            <li><a href="cc_docker_containers.html">Docker containers</a></li>
            
            
            
            
            
            
            <li><a href="cc_internet_of_things.html">Internet of things</a></li>
            
            
            
            
            
            
            <li><a href="cc_technical.html">Cloud technical</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Proposals</a>
        <ul>
            
            
            
            <li><a href="p_consulting.html">Consulting</a></li>
            
            
            
            
            
            
            <li><a href="p_costing.html">Costing</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Research computing</a>
        <ul>
            
            
            
            <li><a href="rc_cloud101_immersion.html">Cloud 101 Immersion</a></li>
            
            
            
            
            
            
            <li><a href="http:escience.washington.edu">WRF Data Science Studio</a></li>
            
            
            
            
            
            
            <li><a href="rc_data_science.html">Data science</a></li>
            
            
            
            
            
            
            <li><a href="rc_research_on_the_web.html">Research on the web</a></li>
            
            
            
            
            
            
            <li><a href="rc_github.html">GitHub</a></li>
            
            
            
            
            
            
            <li><a href="rc_visualization_python.html">Visualization Python</a></li>
            
            
            
            
            
            
            <li><a href="rc_visualization_virtual_globes.html">Visualization virtual globes</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">AWS</a>
        <ul>
            
            
            
            <li><a href="aws_overview.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="aws_walkthrough.html">Walkthrough</a></li>
            
            
            
            
            
            
            <li><a href="aws_console.html">Console</a></li>
            
            
            
            
            
            
            <li><a href="aws_account_management.html">Account management</a></li>
            
            
            
            
            
            
            <li><a href="aws_ec2.html">EC2</a></li>
            
            
            
            
            
            
            <li><a href="aws_spot_market.html">Spot market</a></li>
            
            
            
            
            
            
            <li><a href="aws_cluster.html">Cluster</a></li>
            
            
            
            
            
            
            <li><a href="aws_storage.html">Storage</a></li>
            
            
            
            
            
            
            <li><a href="aws_jupyter.html">Jupyter</a></li>
            
            
            
            
            
            
            <li class="active"><a href="aws_hipaa.html">HIPAA</a></li>
            
            
            
            
            
            
            <li><a href="aws_iot.html">IoT</a></li>
            
            
            
            
            
            
            <li><a href="aws_spark.html">Spark</a></li>
            
            
            
            
            
            
            <li><a href="aws_database.html">Database</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Azure</a>
        <ul>
            
            
            
            <li><a href="az_overview.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="az_walkthrough.html">Walkthrough</a></li>
            
            
            
            
            
            
            <li><a href="az_training.html">Training</a></li>
            
            
            
            
            
            
            <li><a href="az_portal.html">Portal</a></li>
            
            
            
            
            
            
            <li><a href="az_account_management.html">Account management</a></li>
            
            
            
            
            
            
            <li><a href="az_visual_studio.html">Visual Studio</a></li>
            
            
            
            
            
            
            <li><a href="az_web_framework.html">Web Framework</a></li>
            
            
            
            
            
            
            <li><a href="az_machine_learning.html">Machine Learning</a></li>
            
            
            
            
            
            
            <li><a href="az_spark.html">Spark</a></li>
            
            
            
            
            
            
            <li><a href="az_hipaa.html">HIPAA</a></li>
            
            
            
            
            
            
            <li><a href="az_jupyter.html">Jupyter</a></li>
            
            
            
            
            
            
            <li><a href="az_database.html">Database</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Google</a>
        <ul>
            
            
            
            <li><a href="g_overview.html">Overview</a></li>
            
            
            
            
            
            
            <li><a href="g_walkthrough.html">Walkthrough</a></li>
            
            
            
            
            
            
            <li><a href="g_compute_engine.html">Compute Engine</a></li>
            
            
            
            
            
            
            <li><a href="g_preemptible_instances.html">Preemptible Instances</a></li>
            
            
            
            
            
            
            <li><a href="g_earth_engine.html">Earth Engine</a></li>
            
            
            
            
            
            
            <li><a href="g_app_engine.html">App Engine</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Cloud Case Studies</a>
        <ul>
            
            
            
            <li><a href="ccs_precis.html">Precis</a></li>
            
            
            
            
            
            
            <li><a href="ccs_DIF.html">Dynamic Information Framework (DIF)</a></li>
            
            
            
            
            
            
            <li><a href="ccs_high_mountain_asia.html">High Mountain Asia (HiMAT/NASA)</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">AWS Case Studies</a>
        <ul>
            
            
            
            <li><a href="acs_epigenome_imputation.html">Epigenome Imputation</a></li>
            
            
            
            
            
            
            <li><a href="acs_nicadif.html">NicaDIF</a></li>
            
            
            
            
            
            
            <li><a href="acs_geoserver.html">Geoserver and LIDAR</a></li>
            
            
            
            
            
            
            <li><a href="acs_rosetta.html">Rosetta</a></li>
            
            
            
            
            
            
            <li><a href="acs_neurohackweek.html">Neurohackweek</a></li>
            
            
            
            
            
            
            <li><a href="acs_cfd.html">CFD</a></li>
            
            
            
            
        </ul>
        
        
    
    <li>
        <a href="#">Azure Case Studies</a>
        <ul>
            
            
            
            <li><a href="azcs_araldif.html">AralDIF</a></li>
            
            
            
            
            
            
            <li><a href="azcs_organic_chemistry.html">organic chemistry</a></li>
            
            
            
            
        </ul>
        
        
        
        <!-- if you aren't using the accordion, uncomment this block:
           <p class="external">
               <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
           </p>
           -->
    </li>
</ul>
</div>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

    <!-- Content Column -->
    <div class="col-md-9">
        <div class="post-header">
   <h1 class="post-title-main">AWS HIPAA</h1>
</div>



<div class="post-content">

   
    <div class="summary">A HIPAA-compliant research system on AWS</div>
   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    

    

    

    <a target="_blank" href="https://github.com/cloudmaven/documentation/blob/gh-pages/pages/aws/aws_hipaa.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

    

  <h2 id="introduction">Introduction</h2>

<p><a href="aws_hipaa.html">This document</a> presents a secure data management system, specifically using the 
motivation of managing Private Health Information (PHI) under HIPAA regulations on the public cloud. 
This template applies more generally to secure data management in research computing.</p>

<p>HIPAA regulations require data be encrypted both at rest (e.g. on a storage device) and in 
transit (e.g. moving from one storage device to another).  Our hypothetical situation is described 
in further detail below; it is well to keep these rest/transit encryption notions in mind.</p>

<p>Please note that while this study uses AWS we are also building out the construct on the 
Microsoft Azure public cloud.</p>

<h2 id="links">Links</h2>

<ul>
  <li><a href="https://www.hhs.gov/hipaa/index.html/">HIPAA home page</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Health_Insurance_Portability_and_Accountability_Act">HIPAA on Wikipedia</a></li>
  <li><a href="https://www.hhs.gov/hipaa/for-professionals/privacy/laws-regulations/index.html">HIPAA Privacy Rule Summary</a></li>
  <li><a href="https://aws.amazon.com/quickstart/architecture/accelerator-hipaa/">AWS HIPAA template</a></li>
</ul>

<h2 id="warnings">Warnings</h2>

<ul>
  <li><strong><em>AWS has more than nine HIPAA-aligned technologies. A HIPAA-compliant system allows only
these technologies to come into direct contact with PHI.  Other technologies can be used in 
an ancillary capacity only.</em></strong></li>
  <li><strong><em>HIPAA compliance is an obligation of the data system builder, the medical researcher
and the parent organization(s).  The public cloud is very secure: physically and technologically. 
Compromise is most likely to be caused by human error either in design or in operation.</em></strong></li>
  <li><strong><em>File names may not include PHI. They may include identifier strings that could be indexed 
in a secure table.</em></strong></li>
  <li>Do not use T EC2 instance types when building a HCDS. These will not connect to a Dedicated 
Tenancy VPC (simply not supported)</li>
</ul>

<h3 id="preliminary-work">Preliminary Work</h3>

<h4 id="kilroy-stack">Kilroy stack</h4>

<ul>
  <li>Questions from Dogfooding on March 23 2017
    <ul>
      <li>Create VPC…
        <ul>
          <li>Does my VPC need a CIDR that doesn’t overlap other ones in my account? 10.0.0.0 is very popular…</li>
          <li>This is for Aaron</li>
          <li>Stipulate ‘Default Tenancy’</li>
          <li>Creating subnets: AZ: No preference?</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Add K’s remarks and J’s remarks in here</li>
  <li>AB: How to do determine Account has been registered at AWS as PHI/HIPAA-active?</li>
  <li>Generate and incorporate a scientist workflow diagram with extensive caption per User Story</li>
  <li>Generate and incorporate a complete HCDS architecture diagram near the top of this</li>
  <li>Create a sub-topic around <strong>L</strong>: In coffee shop, in a data center (out of Med Research), etcetera
    <ul>
      <li>The ‘in transit / at rest’ component leaves a sparking wire in <strong>L</strong>: Section on risk added</li>
    </ul>
  </li>
  <li>Need explanation of public/private subnet collision avoidance
    <ul>
      <li>Public subnet elements also have private subnet addresses.</li>
      <li>Verify protocol is that new resources auto-generated will be on the private subnet
        <ul>
          <li>AB How is this done? We got as far as ‘no default’ for public and private both</li>
        </ul>
      </li>
      <li>Verify automated allocation will choose free ip addresses on the private subnet</li>
      <li>Verify protocol is to <em>not</em> create new resources on the public subnet</li>
      <li>This is tremendously important so that a new <strong>Wi</strong> is not publicly visible</li>
      <li>Look at the VPC Routing Table “default subnet” column (verify this is correct)</li>
    </ul>
  </li>
  <li>Key management story
    <ul>
      <li>Rename <strong>K2</strong> as <strong>K_Bastion</strong> and describe where it lives on <strong>L</strong>, add to Risk
        <ul>
          <li>It may make sense to describe chain of custody of <strong>KBastion</strong></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Free up and assign <strong>B</strong> an Elastic IP address that will persist
    <ul>
      <li>Verify that this is publicly discoverable and place this fact in Risk</li>
      <li>Rename <strong>K3</strong> as <strong>K_EC2</strong></li>
      <li>Chain of custody of <strong>K_EC2</strong></li>
      <li>How do keys work in view of an AMI source?</li>
    </ul>
  </li>
  <li>EBS Encryption Keys should be a Risk sub-section
    <ul>
      <li>EBS encryption select has an account default key: Details are listed below</li>
      <li>Notice that publishing these details is not technically bad for pedagogy…
        <ul>
          <li>but I have a bit of a nagging doubt here: Are these “Details” global/permanent?</li>
          <li>The screencap redacts to be on the safe side; stay with that for now</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Risk due diligence: Check the DLT account T&amp;C; “who is responsible for the risk?”</li>
  <li>Risk entry: We do not encrypt the boot volume</li>
  <li>Risk entry: EC2 swap space: How does this touch on PHI?</li>
  <li>How are keys / Roles managed when spinning up / shutting down <strong>Wi</strong>?
    <ul>
      <li>For now we allow that <strong>EC2</strong> is the only game in town</li>
    </ul>
  </li>
  <li>Look at the <em>JS</em> <em>SK</em> scenario and build out the IAM component for <em>SK</em>
    <ul>
      <li>e.g. turning machines on and off</li>
      <li>do with console? do with CLI?</li>
      <li>AB: Help needed!</li>
    </ul>
  </li>
  <li>Differentiate SQS and SNS</li>
  <li>What is Ansible and what does it get us?</li>
  <li>Can/should the NAT Gateway be used to pull updates from GitHub?  Generalize.</li>
  <li>DDil on elastic IP: NAT Gateway? Bastion? IG?</li>
  <li>Fix the RT / subnet editing section… gotta get that right</li>
  <li>What are the tradeoffs in building <strong>B</strong> and <strong>M</strong> and <strong>Wi</strong> from AMIs?</li>
  <li>Vestigial details from earlier notes to incorporate
    <ul>
      <li>Logging: CloudWatch and CloudXXXXX are AWS logging services; and this is frequently parsed using Splunk</li>
      <li>Intrusion detection! Jon Skelton (Berkeley AWS Working Group) reviewed use of Siricata (mentions ‘Snort’ also)</li>
      <li>Include an encryption path for importing clinical data</li>
      <li>Include a full story on access key management</li>
      <li>The IOT import will – I think – be a poll action: The secure VM is polling for new data</li>
      <li>This system should include a very explicit writeup of how the human in the loop can break the system</li>
      <li>Acceptable for data on an encrypted drive to moves through an encrypted link to another encrypted drive?
        <ul>
          <li>To clarify: Must the data be further encrypted at rest first?</li>
        </ul>
      </li>
      <li>Filenames may not include PHI. Hence there is an obligation on the MRs to follow this and/or build it into file generation.</li>
      <li>CISO approval hinges on IT, Admin and Research approvals.</li>
      <li>Lambda</li>
    </ul>
  </li>
  <li>Make sure we return to ‘Default subnet’ referred to in the text</li>
  <li>In a route table does 0.0.0.0/0 refer to the public internet? Where does this come up???
    <ul>
      <li>It would be excellent to explain how the smaller CIDR block does not conflict</li>
      <li>with the “wide open internet” sense of the second CIDR block</li>
    </ul>
  </li>
  <li>Bastion server inbound ip range should match UW / UW Med / etcetera
    <ul>
      <li>Also differentiate the UW VPN CIDR block</li>
    </ul>
  </li>
  <li>Could not give my dog <strong>NG</strong> a PIT name!!!</li>
  <li>Bastion and <strong>Sprivate</strong> worker: Need more details on the configuration steps!
    <ul>
      <li>Enable cloudwatch checkbox?</li>
    </ul>
  </li>
  <li>Missing instructions on setting up S3 buckets: For FlowLog and for DataIn</li>
</ul>

<h4 id="user-story">User story</h4>

<ul>
  <li>A scientist <em>SK</em> receives approval from an IRB to work with PHI data.
    <ul>
      <li>Intent: Analyze these data in a secure, HIPAA-compliant data system (herein HCDS)</li>
    </ul>
  </li>
  <li><em>SK</em> contacts <em>JS</em> to build the HCDS as a working environment
    <ul>
      <li>IRB approval review</li>
      <li>System <strong>H</strong> is built by <em>JS</em>; includes an S3 bucket for inbound PHI data <strong>SDI</strong></li>
      <li>Data uploaded to <strong>SDI</strong></li>
    </ul>
  </li>
  <li><em>SK</em> is provided with access
    <ul>
      <li>Keys: <strong>K_Bastion</strong> and <strong>K_EC2</strong></li>
      <li>IAM User account with</li>
      <li><em>K</em> logs on to the HCDS through a secure gateway</li>
      <li><em>K</em> carries out the data analysis over a period of time
        <ul>
          <li>The system logs all activity</li>
        </ul>
      </li>
      <li>IOT devices distributed to patients report health data to the HCDS
        <ul>
          <li>These data supplement the research</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>The study concludes
    <ul>
      <li>Sensitive data are stored to a secure archive</li>
      <li>The HCDS is deleted</li>
      <li>Log files are archived to preserve a complete record of operation for the HCDS</li>
    </ul>
  </li>
  <li>Scientist writes, anticipating a HCDS:
    <ul>
      <li>Early use cases will involve external devices (phones, sensors)
        <ul>
          <li>Data direct to cloud: Authenticate, validate data, match to patient</li>
          <li>Standard format (HL7? CCD?)</li>
        </ul>
      </li>
      <li>Subsequent
        <ul>
          <li>Bidirectional data sharing
            <ul>
              <li>Device, cloud, EHR</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>End result: Allowed persons (care / research) can get to all of this data
        <ul>
          <li>progress in stages</li>
          <li>On the cloud: tools for analysis
            <ul>
              <li>ML, visualizations out, comparative w/r/t analytic datasets etc</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>The IT professional writes:
    <ul>
      <li>Constraints? AWS Services available within the VPC? VPC required?
        <ul>
          <li>Currently 13: API Gateway, Direct Connect, Snowball, DynamoDB, EBS, EC2, EMR, ELB, Glacier, RDS, Aurora, Redshift, S3</li>
          <li>Yes? Expanded how often? Yearly? Extend to entire service platform?
            <ul>
              <li>SA “essentially yes” (je crois BAA expands as the list automatically)</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h4 id="plan-of-action-for-this-hcds-proof-of-concept">Plan of action for this HCDS Proof of Concept</h4>

<ol>
  <li>Write up procedure</li>
  <li>Create a system architecture and diagram
    <ul>
      <li>Anticipate <new data="" to="" EMR=""> pipeline</new></li>
      <li>Anticipate <IOT to="" VM=""> pipeline</IOT></li>
      <li>Anticipate changes to <PHI> VM&gt; process</PHI></li>
      <li>AWS is the big box</li>
      <li>VPC is inside</li>
      <li>Public and Private subnets are inside VPC</li>
      <li>NAT gateway inside the Public subnet box</li>
      <li>Internet Gateway on boundary of VPC</li>
      <li>S3 Endpoint on boundary of VPC</li>
    </ul>
  </li>
  <li>Create artificial data
    <ul>
      <li>data manufacturing software</li>
      <li>generate source artificial data (from EMR)</li>
      <li>generate IOT stream</li>
      <li>anticipate study-to-clinical pipeline</li>
    </ul>
  </li>
  <li>Complete system including analytical tools
    <ul>
      <li>include R, Python, Jupyter</li>
    </ul>
  </li>
  <li>Review with IT personnel (JP first), mgmt, researchers</li>
</ol>

<h4 id="partial-list-of-terminology-and-concepts">Partial list of terminology and concepts</h4>

<ul>
  <li>Ansible</li>
  <li>Regions and Availability Zones on AWS</li>
  <li>Bastion Server</li>
  <li>Siricata / Snort</li>
  <li>CIDR</li>
  <li>Direct tools like <strong>ssh</strong> and third party apps like Cloudberry</li>
  <li>Dedicated Instance</li>
  <li>Lambda Service</li>
  <li>NAT Gateway</li>
</ul>

<h4 id="phi-contact-framework">PHI contact framework</h4>

<p>“How can your system be an HCDS if you are using Lambda?” We identify tools and 
technologies that do / do not interface directly with PHI.</p>

<ul>
  <li>Tools that do not come in contact with PHI can be thought of as ‘triggers and orchestration’.</li>
  <li>Services that may come in contact with PHI can be described as ‘data and compute’</li>
</ul>

<h4 id="hipaa-aligned-technologies">HIPAA-aligned technologies</h4>

<p>Here is a partial list of AWS Technologies that are HIPAA-aligned. New 
services accrue automatically to the <em>allowed</em> category as AWS adds them.</p>

<ul>
  <li>S3 storage</li>
  <li>EC2 compute instances (VMs)</li>
  <li>EBS elastic block storage: Attached filesystem</li>
  <li>RDS relational database service</li>
  <li>DynamoDB database</li>
  <li>EMR elastic map reduce: Hadoop/Spark engine support</li>
  <li>ELB elastic load balancer</li>
  <li>Glacier archival storage</li>
  <li>Redshift data warehouse</li>
</ul>

<h4 id="encryption">Encryption</h4>

<ul>
  <li>HIPAA requires data be encrypted at rest, i.e. on a storage device</li>
  <li>HIPAA requires data be encrypted in transit, e.g. moving from one storage device to another</li>
</ul>

<h4 id="multiple-sources-of-data">Multiple sources of data</h4>

<ul>
  <li>Electronic Medical Records (EMR)</li>
  <li>A Data Warehouse (tables)</li>
  <li>A Clinician</li>
  <li>Sensors stream data from patient</li>
</ul>

<h4 id="destinations">Destinations</h4>

<ul>
  <li>S3 bucket</li>
  <li>EBS/EFS</li>
</ul>

<h4 id="procedural-format">Procedural format</h4>

<p>We punctuate the procedural steps needed to build the HIPAA-Compliant Data System (HCDS) 
with short notes on rationale, how things fit together. We also make extensive use of 
very short abbreviations (just about every entity gets one, indicated by <strong>boldface</strong> 
and obsessive re-naming of everything using the Project Identifier Tag (PIT)</p>

<h3 id="part-1-getting-started">Part 1: Getting started</h3>

<h4 id="activity-zero">Activity Zero</h4>

<p>Your absolute First Priority Step 0 is to designate to AWS that the account you are using
involves PII/PHI/HIPAA data.</p>

<h4 id="saving-money">Saving money</h4>

<p>This will be a multi-day effort. Shut down instances to save money at the end of the day.</p>

<h4 id="review-objectives">Review objectives</h4>

<p>Our main objective is (see Figure below) to use a Laptop or other cloud-external data source
to feed data into a HIPAA-Compliant Data System <strong>HCDS</strong> wherein we operate on that data. 
The data are assumed to be Private Health Information (PHI) or Personally Identifiable 
Information (PII) as described in HIPAA regulations.</p>

<h4 id="pit-means-project-identifier-tag-an-informal-term">PIT means Project Identifier Tag (an informal term)</h4>

<ul>
  <li>Write down or obtain a Project Identifier Tag (PIT) to use in naming/tagging everything
    <ul>
      <li>This is a handy string of characters</li>
      <li>In our example here PIT = ‘hipaa’. Short, easy to read = better</li>
    </ul>
  </li>
</ul>

<h4 id="source-computer">Source computer</h4>

<ul>
  <li>Identify our source computer as <strong>L</strong>, a Laptop sitting in a coffee shop
    <ul>
      <li>This is intentionally a <em>non-secure</em> source</li>
      <li><strong>L</strong> does <em>not</em> have a PIT</li>
      <li><strong>L</strong> could also be a secure resource operated by Med Research / IRB / data warehouse</li>
    </ul>
  </li>
</ul>

<p>We are starting with a data source and will return to encryption later. The first burst 
of activity will be the creation of a Virtual Private Cloud (VPC) on AWS per the diagram
above. We assume you have done Step 0 above and are acting in the capacity of a
system builder; but you may not be an experienced IT professional. That is: We assume
that you are building this environment and that you may or may not be doing research
once it is built; but someone will.</p>

<h4 id="vpc-via-wizard-versus-manual-build">VPC via Wizard versus manual build</h4>

<p>The easiest way to create a VPC is using the console Wizard. That method is covered in a 
section below and it can automate many of the steps we describe manually.  We describe 
the manual method to illuminate the components.</p>

<h4 id="cidr-block-specification">CIDR block specification</h4>

<p>The CIDR block syntax uses a specification like <strong>10.0.0.0/16</strong>. This has two 
components: A ‘low end of range’ ip address <strong>w.x.y.z</strong> and a width parameter <strong>/N</strong>. 
w, x, y and z are integers from 0 to 255, in total 32 bits of address space.</p>

<p><strong>N</strong> determines an addressable space of size s = 2^(32 - N). For example 
N = 16 produces s = 2^16 or s = 65536 available addresses, starting at w.x.y.z.</p>

<p>An example: Suppose we specify 10.0.0.0/16.
Then s = 2^16 so 65536 addresses are available: 10.0.0.0, 10.0.0.1, 10.0.0.2, …,
10.0.1.0, 10.0.1.0, …, 10.0.255.255. <strong>y</strong> and <strong>z</strong> together span the address 
space.</p>

<p>These ip addresses are defined in the VPC, contextually <em>local</em> within the VPC.</p>

<p>Any subnets we place within the VPC will be limited by this address space.<br />
In fact we proceed  by defining subnets within the VPC with respective 
CIDR ranges, subranges of the VPC CIDR block.  The first subnet will have 
CIDR = 10.0.0.0/24 with 256 addresses available: 10.0.0.0, 10.0.0.1, …, 
10.0.0.255. Five of these will be appropriated by AWS machinery, incidentally.
The second subnet will be non-overlapping with CIDR range = 10.0.1.0/24.</p>

<p>Since AWS appropriates five ip addresses for internal use
(.0, .1, .2, .3, and .255) we should look for ways of making 
ip address assignment automatic.</p>

<h3 id="part-2-creating-and-populating-a-virtual-private-cloud">Part 2 Creating and populating a Virtual Private Cloud</h3>

<h4 id="building-the-vpc">Building the VPC</h4>

<p>Here we abbreviate elements with boldface type. In most cases the entity we create
can be named so to remind you: For consistency we have come up with a Project
Identifier Tag like ‘hipaa’ so that each entity can be given a PIT name: ‘hipaa_vpc’
and so on.</p>

<ul>
  <li>
    <p>From the console create a new VPC <strong>V</strong></p>

    <ul>
      <li>
        <p>Give <strong>V</strong> a PIT name</p>
      </li>
      <li>
        <p><strong>V</strong> will not use IPv6v.</p>
      </li>
      <li><strong>V</strong> will have a CIDR block defining an ip address space
        <ul>
          <li>We use 10.0.0.0/16: 65536 (minus a few) available addresses</li>
        </ul>
      </li>
      <li><strong>V</strong> automatically has a routing table <strong>RT</strong>
        <ul>
          <li>Select Routing Tables, sort by VPC and give <strong>RT</strong> a PIT name
            <ul>
              <li>‘hipaa_routingtable’</li>
              <li>The routing table is a logical mapping of ip addresses to destinations</li>
            </ul>
          </li>
        </ul>
      </li>
      <li><strong>V</strong> is automatically given a security group <strong>SG</strong>
        <ul>
          <li>Select Security Groups, sort by VPC and give <strong>SG</strong> a PIT name
            <ul>
              <li>‘hipaa_securitygroup’</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Create an associated Flow Log <strong>FL</strong>
        <ul>
          <li>In March 2017 the AWS console UI was a little tetchy so be prepared to go around twice</li>
          <li>On the console view of the VPC: Click the Create Flow Log button
            <ul>
              <li>Assuming permissions are not set: Click on the Hypertext to <strong>Set up permissions</strong>
                <ul>
                  <li>Because: We need to define the proper Role</li>
                  <li>On the Role creation page: Give the Role a PIT name; Create new; Allow</li>
                  <li>You now have an IAM Role for FlowLogs
                    <ul>
                      <li>This gives the account the necessary AWS permissions to work with Flow Logs</li>
                      <li>In so doing we fell out of the Create Flow Log dialog so… back around</li>
                    </ul>
                  </li>
                </ul>
              </li>
              <li>Return to the VPC in the console</li>
              <li>Click on Create Flow Log
                <ul>
                  <li>Filter = All is required (not “accepted” and not “rejected” traffic)</li>
                  <li>Role: Select the role we just created above</li>
                  <li>Destination log group: Give it a PIT name
                    <ul>
                      <li>Example: hipaa_loggroup</li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Create subnets <strong>Spublic</strong> and <strong>Sprivate</strong>
        <ul>
          <li>The private subnet <strong>Sprivate</strong> is where work on PHI proceeds
            <ul>
              <li>CIDR block 10.0.1.0/24</li>
              <li><strong>Sprivate</strong> will be firewalled behind a NAT gateway
                <ul>
                  <li>This prevents traffic in (such as ssh)</li>
                </ul>
              </li>
            </ul>
          </li>
          <li>The public subnet <strong>Spublic</strong> is for internet access
            <ul>
              <li>CIDR block 10.0.0.0/24</li>
              <li><strong>Spublic</strong> connects with the internet via an Internet Gateway</li>
              <li><strong>Spublic</strong> will be home to a Bastion server <strong>B</strong></li>
              <li><strong>Spublic</strong> will be home to the NAT Gateway <strong>NG</strong> mentioned above
                <ul>
                  <li><strong>B</strong> and <strong>NG</strong> are on the public subnet but also have private subnet ip addresses
                    <ul>
                      <li>That is: Everthing on the public subnet also has a private ip address in the VPC.</li>
                      <li>This will use the private ip address space</li>
                      <li>Public names will resolve to private addresses within the VPC at need.</li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Create an an Internet Gateway <strong>IG</strong>
        <ul>
          <li>Give a PIT name as in ‘hipaa_internetgateway’</li>
          <li>Attach hipaa_internetgateway to <strong>V</strong></li>
        </ul>
      </li>
      <li>Create a NAT Gateway <strong>NG</strong>
        <ul>
          <li>Give it a PIT name</li>
          <li>Elastic IP assignment may come into play here</li>
        </ul>
      </li>
      <li>Create a route table <strong>RTpublic</strong>
        <ul>
          <li>Give it a PIT name: ‘hipaa_publicroutes’</li>
          <li>This will supersede the <strong>V</strong> routing table <strong>RT</strong></li>
          <li>Select the Subnet Associations tab
            <ul>
              <li>Edit subnet association to be <strong>Spublic</strong></li>
            </ul>
          </li>
          <li>Select the Routes tab
            <ul>
              <li>Edit (under Routes) and add 0.0.0.0/0 pointing to <strong>IG</strong></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>Note: The console column for subnets shows “Auto-assign Public IP” and this should be set to
<em>Yes</em> for <strong>Spublic</strong>. Note the column title includes the term <em>Public IP</em>. The Private subnet 
should have this set to <em>No</em>. If necessary change these entries using the <em>Subnet Actions</em> 
button.</p>

<p>Note: In the subnet table find a “Default Subnet” column. In this work-through both <strong>Spublic</strong> 
and <strong>Sprivate</strong>  have this set to <em>No</em>:  There is no default subnet.  This will be modified
later via the route table <strong>RT</strong> in <strong>V</strong>.</p>

<p><strong>RT</strong> reads:<br />
<code class="highlighter-rouge">
10.0.0.0/16         VPC "local" 
0.0.0.0/0           NAT gateway 
</code></p>

<p><strong>RTpublic</strong> (hipaa_publicroutes) has
<code class="highlighter-rouge">
10.0.0.0/16 
0.0.0.0/0      Internet Gateway
</code></p>

<p>We now have two RTs. hipaa_routingtable (default for the VPC in general) and for 
Spublic (hipaa_publicroutes). Notice that <strong>RT</strong> operates by default and <strong>RTpublic</strong>
supersedes this on <strong>Spublic</strong>. This means that new resources on <strong>Sprivate</strong> will
by default use <strong>NG</strong> which is what we want.</p>

<p>The <strong>V</strong> <strong>RT</strong> 0-entry points at <strong>NG</strong>: All internet-traffic will route through <strong>NG</strong>. 
<strong>NG</strong> does not accept inbound traffic. This is by default. (Analogy: Home router)</p>

<p><strong>Spublic</strong> has the custom <strong>RTpublic</strong> which routes non-local traffic to the IG, i.e. 
the internet. This <em>does</em> accept inbound traffic allowing us to ssh in. This is an exception
to the default.</p>

<h3 id="part-3-adding-ec2-and-s3-resources-to-the-vpc">Part 3: Adding EC2 and S3 resources to the VPC</h3>

<h4 id="building-a-bastion-server-b">Building a Bastion Server <strong>B</strong></h4>

<ul>
  <li>On <strong>V</strong> create a public-facing Bastion Server <strong>B</strong>
    <ul>
      <li><strong>B</strong> has only port 22 open (to support ssh)</li>
      <li><strong>B</strong> uses Secure Groups on AWS to limit access to only a subset of URLs</li>
      <li><strong>B</strong> can be a modest general-purpose machine such as a m4.large
        <ul>
          <li>In this example we choose an m4.large running AWS Linux</li>
          <li>DO NOT USE T instances
            <ul>
              <li>They will not connect to our Dedicated Tenancy VPC: This is not supported.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Go through all config steps: Memory, tags;
        <ul>
          <li>Security group is important
            <ul>
              <li>Create a new security group</li>
              <li>PIT name: hipaa_bastion_ssh_securitygroup</li>
              <li>Description = allow ssh from anywhere</li>
              <li>Notice that in the config table “Source” is 0.0.0.0/0 which is “anywhere”
                <ul>
                  <li>Best practice is to restrict the inbound range</li>
                  <li>Consider differentiating UW from the UW-VPN
                    <ul>
                      <li>This would allow someone to log in from anywhere VIA the UW VPN</li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>Key pair use a PIT as ‘hipaa_bastion_keypair’
            <ul>
              <li>Generate new, download to someplace safe on <strong>L</strong></li>
            </ul>
          </li>
          <li>Launch instance</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="building-a-work-environment-ec2-instance-on-sprivate">Building a work environment EC2 instance on <strong>Sprivate</strong></h5>

<ul>
  <li>On <strong>Sprivate</strong> install a small Dedicated EC2 instance <strong>E</strong></li>
</ul>

<p>We are now configuring the S3 Endpoint. 
  In so doing we selected the VPC RT (not the public subnet RT; could use that)
  We are concerned about S3 traffic
  S3 Endpoint is a new type of Gateway that gives S3 access from Private subnet direct into S3 without any traverse of the internet.</p>

<p>WARNING: Kilroy: After I added the S3 Endpoint the NAT gateway entry had vanished from my VPC routing table. 
This is bad. Right now the procedure is going to be: After S3 EP go examine RT and re-add NAT gateway if it 
is not properly present. holy cow!!!!!!!!!!!!!!!</p>

<p>Created S3 bucket</p>

<h3 id="part-4-ancillary-components">Part 4: Ancillary components</h3>

<p>This section describes the use of automated services, data bases tables, IOT endpoints and other 
AWS features to augment the HCDS. Such ancillary components may or may not touch directly on PHI,
an important differentiator as only HIPAA-aligned technologies are permitted to do so.</p>

<ul>
  <li>Set up a DynamoDB table to track names of uploaded files</li>
  <li>Set up a Lambda service
    <ul>
      <li>Triggered by new object in bucket in the S3 input bucket</li>
      <li>This Lambda service is managed using a role</li>
    </ul>
  </li>
  <li>Set up an SQS Simple Queue Service <strong>Q</strong></li>
  <li>Create an SNS to notify me when interesting things happen</li>
</ul>

<h3 id="part-5-encryption">Part 5: Encryption</h3>

<p>Suppose on EC2 we create an EBS volume for the PHI
So is the “comes with” EBS volume encrypted? No. Therefore: Keep data on /hipaa
Volume type = General Pupose and the size does affect IOPS; I went for 64GB</p>

<p>For costing and performance include this link: http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSVolumeTypes.html</p>

<p>This gets back into optimization; it does not affect our HIPAA story</p>

<p>Notice the EBS volume has an AZ which <strong>must match</strong> the target EC2 where it is going</p>

<p>Notice the volume can by encrypted with a check box; and then there is a Master Key issue.</p>

<p>Using the default key technically encrypts this data at rest. So that’s done.</p>

<p>Working with your own set of keys would be part of risk management: Should the keys be compromised etcetera.
So there is some additional hassle and so on but some potential risk management.</p>

<p>The question is: Do we want to use one key across multiple environments (the default) or created new keys for 
each new envvironment? How much hassle, etc.</p>

<p>ok done: hipaa_ebs_ec2_private</p>

<p>Next log in to EC2 on the private subnet:
- log in to the bastion server
- used copy-paste to edit a file on the bastion called ec2_private_keypair.pem
  - I did a bad paste and was missing the —–BEGI
  - on this file we ran chmod 600 on the pem file
  - ssh -i <this file=""> 10.0.1.248
    - notice this ip address is in the console Description tab when highlighting the private subnet EC2 instance
  - Notice that the pem file on the bastion would immediately compromise the EC2 on the private subnet
    - That sure sucks for you</this></p>

<p>Using (sudo) fdisk to create the partition on the raw block device (fast: writing the partition table) will blow 
away anything already there.</p>

<p>Now we did the simple</p>

<p>% aws s3 cp s3://bucket-name/keyname .</p>

<p>The keyname that I used was the filename that I uploaded to this S3 bucket from <strong>L</strong>. 
That file was pushed from <strong>L</strong> using the console but can also be done using the CLI.</p>

<p>We are intentionally not going to encrypt the boot volume. It can be done; goes on the DD pile.</p>

<p>We implement server side encryption on S3 next. 
- The file may be unencrypted on <strong>L</strong>
- We upload it to S3 and stipulate “encrypt this when it comes to rest in S3”
- S3 manages this
- We create an associated policy that <em>only</em> allows this type of upload
  - Therefore a not-encrypted-at-rest request will be denied</p>

<p>Best way is follow “S3 AWS encryption” links to http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingEncryption.html
Click Server-Side Encryption
Click on Amazon S3-Managed Encryption keys in the left bar to get to 
http://docs.aws.amazon.com/AmazonS3/latest/dev/UsingServerSideEncryption.html</p>

<p>Copy the code box contents
Go to console
S3 bucket
Permissions tab
Bucket Policy button
Paste
Replace in two places: actual bucket name</p>

<p>PutObject command: must have server-side-encryption set to AES256 (that is the name of the encryption algorithm) 
  AND
must have server-side-encryption set to true</p>

<p>What about the inbound files: They must be “encrypted in transit” so we get that with an https endpoint to S3: Done.</p>

<p>Transferring to the instance: scp</p>

<p>Last encryption note: SSL is used by the CLI be default; so our EC2-private command ‘aws s3 … etc’: 
Look at cli/latest/reference for the link on this. This means that S3 to EC2private is encrypted in transit. 
The EBS /hipaa is encrypted at rest. Done.</p>

<h3 id="part-6-auditing">Part 6: Auditing</h3>

<p>HCDS activity must be logged in such a manner as to permit subsequent tracing of PHI data 
access and ongoing monitoring of the security state of the system.</p>

<h4 id="cloudtrail-and-cloudwatch">CloudTrail and CloudWatch</h4>

<p>CloudTrail is logging the API calls to my account. Whether through the console, the CLI, the APIs directly: All logged in 
cloud trail once it is enabled. They all use the same APIs; so we log on the API calls. Logs to S3.</p>

<p><strong>Here is the key thing: Enable cloud trail which creates a destination S3 bucket where all of the logging will go.</strong></p>

<p>Best practice is to turn on Cloud Trail in all of your regions; so you are not blind. “Either you are logging or it is gone.”</p>

<p>Cloud Watch is more for monitoring: Performance metrics.</p>

<p>In both cases there is never PHI data in the log: PRovided ss#s are not in the filenames (for example)</p>

<p>And S3 has its own internal logging mechanism as well. 
- Create a new bucket hipaa-s3-access-logs with vanilla settings
- Locate the existing inbound data bucket &gt; Properties &gt; Logging &gt; enable &gt; stipulate the access logs bucket; add a tag…</p>

<p>This will have http traffic details; where stuff was coming from for example</p>

<h4 id="aws-config">AWS Config</h4>

<p>Cloud trail tells you what’s happening in terms of the API
AWS Config tells you what changed</p>

<p>Use them together to see if something is happening / happened of concern</p>

<p>High level set up and then more detailed is possible</p>

<p>Console &gt; MAnagement &gt; Config</p>

<p>Think of Config (like Cloud Trail) as account-wide, not “per resource” so tagging with the PIT is not correct.</p>

<p>My process was pretty default.</p>

<p>So now we have Cloud Trail, S3 logging and Config operating on this account. 
So as we get more sophisticated we could dig in to Cloud Watch.</p>

<h3 id="part-7-disaster-recovery">Part 7: Disaster Recovery</h3>

<p>Indicate awareness; up to CISO to provide hurdles</p>

<h3 id="part-8-generating-pseudo-data">Part 8: Generating Pseudo-Data</h3>

<h3 id="part-9-system-operation">Part 9: System operation</h3>

<h3 id="part-10-concluding-remarks">Part 10: Concluding remarks</h3>

<ul>
  <li>Set up Ansible-assisted process for configuring and running jobs on EC2 instances</li>
  <li>Pushing data to S3
    <ul>
      <li>Console does not seem like a good mechanism</li>
      <li>Third party apps such as Cloudberry are possible…</li>
      <li>AWS CLI with scripts: Probably the most direct method</li>
    </ul>
  </li>
  <li>Compute scale test: Involves setting up some substantial processing power
    <ul>
      <li>Implication is that the HCDS can intrinsically fire up EC2 instances as needed</li>
      <li>Launch <strong>W</strong> x 5 Dedicated instances, call these <strong>Wi</strong></li>
      <li>Assign S3 access role</li>
      <li>Encrypted volumes</li>
      <li>S/w pre-installed (e.g. genomics pipelines)</li>
      <li>Update issue: Pipeline changes, etcetera;</li>
    </ul>
  </li>
  <li><strong>Wi</strong> can be pre-populated with reference data: Sheena Todhunter operational scenario
    <ul>
      <li>Assumes that a HCDS exists in perpetuity to perform some perfunctory pipeline processing</li>
      <li>On <strong>B</strong>
        <ul>
          <li>Create SQS queue of objects in S3</li>
          <li>Start a <strong>Wi</strong> for each message in queue…</li>
        </ul>
      </li>
      <li>Go
        <ul>
          <li>Latest pipeline… EBS Genomes… chew</li>
          <li>If last instance running: Consolidate / clean-up</li>
        </ul>
      </li>
      <li>SNS topic notifies me when last instance shuts down.
        <ul>
          <li>Run Ansible script to configure <strong>Wi</strong> (patch, get data file names from DynamoDB table, etcetera)</li>
          <li>Get Ws the Key from E</li>
          <li>The Ws send an Alert through the NAT gateway to Simple Notification Service (SNS)</li>
          <li>Which uses something called SES to send an email to the effect that the system is working with PHI data
            <ul>
              <li>Ws pull data from S3 using VPC Endpoint; thanks to the Route table</li>
              <li>Ws decrypt data using HomerKey</li>
              <li>Ws process their data into result files: Encrypted EBS volume.</li>
              <li>Optionally the result files are encrypted in place in the EBS volume.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Through <strong>S3EP_O</strong> the results are moved to S3.</li>
      <li><strong>Wi</strong> sends an Alert through the NAT gateway to SNS
        <ul>
          <li>which uses something called SES to send another email: Done</li>
        </ul>
      </li>
      <li><strong>Wi</strong> evaporates completely leaving no trace</li>
    </ul>
  </li>
</ul>

<h2 id="procedure-log">Procedure Log</h2>

<p>Create a VPC <strong>V</strong></p>

<p><img src="/documentation/images/aws/hipaa0001.png" alt="pic0001" /></p>

<p><img src="/documentation/images/aws/hipaa0002.png" alt="hipaa0002" /></p>

<ul>
  <li>Use the name ‘hipaa’; should be unique.</li>
  <li>CIDR as shown is typical.</li>
  <li>Dedicated Instance means: Nobody else allowed here.</li>
</ul>

<p><img src="/documentation/images/aws/hipaa0003.png" alt="hipaa0003" /></p>

<ul>
  <li>I added a tag indicating that I originated the VPC.</li>
</ul>

<h3 id="create-a-subnet">Create a subnet</h3>

<p><img src="/documentation/images/aws/hipaa0004.png" alt="hipaa0004" /></p>

<p><img src="/documentation/images/aws/hipaa0005.png" alt="hipaa0005" /></p>

<p>Public subnet addresses will be of the form: 10.0.0.2, .3, .4, … .254</p>

<p><img src="/documentation/images/aws/hipaa0006.png" alt="hipaa0006" /></p>

<p>Take note of the AZ:</p>

<p><img src="/documentation/images/aws/hipaa0007.png" alt="hipaa0007" /></p>

<p>We could do multiple public sub-nets by creating more than one in multiple Azs; that is a big-time concept.</p>

<p>Now the private one:</p>

<p><img src="/documentation/images/aws/hipaa0007.png" alt="hipaa0007" /></p>

<p><img src="/documentation/images/aws/hipaa0008.png" alt="hipaa0008" /></p>

<p><img src="/documentation/images/aws/hipaa0009.png" alt="hipaa0009" /></p>

<p><img src="/documentation/images/aws/hipaa0010.png" alt="hipaa0010" /></p>

<p>Attach it to the VPC:</p>

<p><img src="/documentation/images/aws/hipaa0011.png" alt="hipaa0011" /></p>

<p><img src="/documentation/images/aws/hipaa0012.png" alt="hipaa0012" /></p>

<p>Now for the NAT Gateway</p>

<p><img src="/documentation/images/aws/hipaa0013.png" alt="hipaa0013" /></p>

<p>Choose the public one in czarhipaa</p>

<p><img src="/documentation/images/aws/hipaa0014.png" alt="hipaa0014" /></p>

<p><img src="/documentation/images/aws/hipaa0015.png" alt="hipaa0015" /></p>

<p>Notice we Created a New EIP</p>

<p><img src="/documentation/images/aws/hipaa0016.png" alt="hipaa0016" /></p>

<p>Now the Route Table</p>

<p><img src="/documentation/images/aws/hipaa0017.png" alt="hipaa0017" /></p>

<p><img src="/documentation/images/aws/hipaa0018.png" alt="hipaa0018" /></p>

<p><img src="/documentation/images/aws/hipaa0019.png" alt="hipaa0019" /></p>

<p>Here they are (including the default main one):</p>

<p><img src="/documentation/images/aws/hipaa0020.png" alt="hipaa0020" /></p>

<p><img src="/documentation/images/aws/hipaa0021.png" alt="hipaa0021" /></p>

<p>Edit and modify as shown:</p>

<p><img src="/documentation/images/aws/hipaa0022.png" alt="hipaa0022" /></p>

<p>Save</p>

<p>And then under Subnet Associations tab: Edit:</p>

<p><img src="/documentation/images/aws/hipaa0023.png" alt="hipaa0023" /></p>

<p>Now let us go back to the Route Table selector</p>

<p><img src="/documentation/images/aws/hipaa0024.png" alt="hipaa0024" /></p>

<p><img src="/documentation/images/aws/hipaa0025.png" alt="hipaa0025" /></p>

<p><img src="/documentation/images/aws/hipaa0026.png" alt="hipaa0026" /></p>

<p>Subnet Associations tab:</p>

<p><img src="/documentation/images/aws/hipaa0027.png" alt="hipaa0027" /></p>

<p><img src="/documentation/images/aws/hipaa0028.png" alt="hipaa0028" /></p>

<p>Now for the Endpoint</p>

<p><img src="/documentation/images/aws/hipaa0029.png" alt="hipaa0029" /></p>

<p>Notice that this has Full Access; we will restrict access at a later step.</p>

<p><img src="/documentation/images/aws/hipaa0030.png" alt="hipaa0030" /></p>

<p>end as of Jan 27 2017.</p>

<h2 id="risk">Risk</h2>

<p>This section identifies points of risk and their severity. Severity is described both
‘when protocol is properly observed’ and ‘when protocol is not observed’. That is: We 
provide examples of how failure to follow protocols could result in the compromise of 
PHI. There is in all of this a notion of diminishing returns: A tremendous amount of 
additional effort might be incorporated in building an HCDS that provides only small 
reduction of risk.</p>

<h3 id="protocols-described-in-this-document">Protocols described in this document</h3>

<h4 id="vpc-creation-manual-versus-wizard">VPC creation: Manual versus Wizard</h4>

<h3 id="options-outside-the-purview-of-this-document">Options outside the purview of this document</h3>

<h4 id="dedicated-instances">Dedicated instances</h4>

<p>We drive cost up using dedicated instances on <strong>Sprivate</strong>. It is technically feasible
to not do this but there is an attendant cost in time and risk.</p>

<h4 id="extended-key-management-strategy">Extended key management strategy</h4>

<p>Encryption keys here are taken to be default keys associated with the AWS account. 
It is possible on setting up the HCDS to create an entire structure around management 
of newly-generated keys. This is a diminishing-returns risk mitigation procedure:
It may create a profusion of complexity that is itself a risk.</p>

<p>One open question is whether a single AWS account should / could / will be used to
provision multiple independent research projects, each with one or more respective 
data systems.</p>

<ul>
  <li>Log in to <strong>B</strong> and move <strong>K</strong> to <strong>E</strong>
    <ul>
      <li>Observe that material encrypted</li>
      <li>Maybe instead we should be tunneling directly to <strong>E</strong> from <strong>L</strong></li>
    </ul>
  </li>
  <li>
    <p>Use an AMI to create a processing EC2 <strong>W</strong></p>

    <ul>
      <li>Also with <strong>ENC</strong></li>
    </ul>
  </li>
  <li>Create S3 buckets
    <ul>
      <li><strong>S3D</strong> for data</li>
      <li><strong>S3O</strong> for output</li>
      <li><strong>S3L</strong> for logging</li>
      <li>
        <p><strong>S3A</strong> for ancillary purposes (non-PHI is the intention)</p>
      </li>
      <li>Such S3 buckets only accept http PUT; not GET or LIST</li>
    </ul>
  </li>
  <li>Create an S3 bucke <strong>S3O</strong> for output</li>
  <li>Create an S3 bucke <strong>S3L</strong> for logging</li>
  <li>Create an S3 Endpoint <strong>S3EP_D</strong> in <strong>V</strong></li>
  <li>Create an S3 Endpoint <strong>S3EP_O</strong> in <strong>V</strong></li>
  <li>Create an S3 Endpoint <strong>S3EP_L</strong> in <strong>V</strong>
    <ul>
      <li>“S3 buckets have a VPC Endpoint included… ensure this terminates inside the VPC”</li>
    </ul>
  </li>
  <li>Create role <strong>R</strong> allowing <strong>W</strong> to read data at <strong>S3EP</strong> from <strong>S3</strong></li>
</ul>



    <div class="tags">
        
        <b>Tags: </b>
        
        
        
        <a href="tag_AWS.html" class="btn btn-default navbar-btn cursorNorm" role="button">AWS</a>
        
        
        
        <a href="tag_HIPAA.html" class="btn btn-default navbar-btn cursorNorm" role="button">HIPAA</a>
        
        
        
        <a href="tag_medicine.html" class="btn btn-default navbar-btn cursorNorm" role="button">medicine</a>
        
        
        
        <a href="tag_data_management.html" class="btn btn-default navbar-btn cursorNorm" role="button">data_management</a>
        
        
        
        <a href="tag_case_studies.html" class="btn btn-default navbar-btn cursorNorm" role="button">case_studies</a>
        
        
        
        <a href="tag_storage.html" class="btn btn-default navbar-btn cursorNorm" role="button">storage</a>
        
        
        
        <a href="tag_research_computing.html" class="btn btn-default navbar-btn cursorNorm" role="button">research_computing</a>
        
        
        
        <a href="tag_data_science.html" class="btn btn-default navbar-btn cursorNorm" role="button">data_science</a>
        
        
        
    </div>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2017 cloudmaven. All rights reserved. <br />
<span>Page last updated:</span> January 25, 2017<br/> Site last generated: Mar 26, 2017 <br />
<p><img src="images/Picture1.gif" alt="Company logo"/></p>
                </div>
            </div>
</footer>


    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
    </div>

</body>

</html>