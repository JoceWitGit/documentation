
* Some entity pushes data to S3. 
  * File names must not contain PHI 
  * Uses a 3rd party app such as Cloudberry
    * What is Cloudberry?
  * Uses the AWS CLI
  * Uses an API call (this is a programmatic way to keep PHI out of file names)
    * Lambda notices this, appends the file names to DynamoDB and pings B 
    * B tries to run a new processing job
* Launch five W instances, dedicated
* Assign them S3 access role
* W have encrypted volumes
* W have a pipeline pre-installed
  * The pipeline may be update and the AMI could subsequently be updated as well
* EBS volumes come pre-loaded with reference data (non-PHI) that the pipeline might use
* Sheena notes
  * Bastion Server Setup
    * Get worker public key from S3 (which allows us to ssh from bastion into worker if need be) 
    * Create SQS queue of all objects (samples) listed in S3 bucket 
    * Kick off a worker instance for each message in the queue
  * Setup and Execution
    * Grab latest pipeline code, install
    * Create EBS Genomes volume from snapshot
    * Grab message from SQS which is really a file for analysis in S3
    * Grab fastq files from S3
    * Run analysis
    * Write message to done queue
    * If last instance running, grab certain analysis files from S3 to create run level output



* SNS topic notifies me when last instance shuts down.
  * Run Ansible script to configure Ws (patch, get data file names from DynamoDB table, etcetera)
  * Get Ws the Key from E
  * The Ws send an Alert through the NAT gateway to Simple Notification Service (SNS) 
    * Which uses something called SES to send an email 'system is working on PHI data'. 
      * Ws pull data from S3 using VPC Endpoint; thanks to the Route table
      * Ws decrypt data using HomerKey
      * Ws process their data into result files: Encrypted EBS volume. 
      * Optionally the result files are encrypted in place in the EBS volume.
  * Through the VPC Endpoint the results are moved to S3.
  * Ws send an Alert through the NAT gateway to Simple Notification Service (SNS) 
    * which uses something called SES to send another email: 'We're done now.'
  * Ws evaporate completely leaving no trace. 
  * B returns to quiescent state. 


## Procedure

We use the name 'czarhipaa'; this should be unique.

CIDR as shown is typical.

Dedicated Instance means: Nobody else allowed here. 

Now it exists; time to fill it with stuff.

